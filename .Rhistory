library(tidyverse)
library(lubridate)
library(ggrepel)
library(rvest)
ub ="https://fbref.com/en/comps/12/La-Liga-Stats"
liga=read_html(ub,as.data.frame=TRUE,stringAsFactors=TRUE) %>%
html_nodes("table") %>% .[[1]] %>% html_table(fill=TRUE)
liga <- liga %>% mutate(descenso = case_when(
Rk >= 17 ~ "Descenso",
TRUE ~ "No descenso"))
liga %>% ggplot(aes(x=xGA, y=GA, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +scale_color_gradient2(midpoint = 10, low = "blue", mid = "grey",
high = "red", space = "Lab" )
liga %>% ggplot(aes(x=xGA, y=GA, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +
scale_color_gradient2(midpoint = 10, low = "blue", mid = "grey",
high = "red", space = "Lab" ) +
theme_get()
liga %>% ggplot(aes(x=xGA, y=GA, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +
scale_color_gradient2(midpoint = 10, low = "blue", mid = "grey",
high = "red", space = "Lab" ) +
theme_light()
liga %>% ggplot(aes(x=xGA, y=GA, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +
scale_color_gradient2(midpoint = 12, low = "blue", mid = "grey",
high = "red", space = "Lab" ) +
theme_light()
liga %>% ggplot(aes(x=xGA, y=xG, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +scale_color_gradient2(midpoint = 10, low = "blue", mid = "grey",
high = "red", space = "Lab" )
liga %>% ggplot(aes(x=xGA, y=xG, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +scale_color_gradient2(midpoint = 12, low = "blue", mid = "grey",
high = "red", space = "Lab" )
liga %>% ggplot(aes(x=xGA, y=xG, label=Squad, color=Rk)) + geom_point()  +
geom_text_repel(size = 3) +scale_color_gradient2(midpoint = 12, low = "blue", mid = "grey",
high = "red", space = "Lab" ) +
theme_light()
tiros <- readRDS( './data/tiros_202211.rds')
laliga <- tiros %>% filter(league_name=='LaLiga')
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team)) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name)
View(df)
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% filter(event_type=='AttemptSaved') %>% group_by(Equipo_contrario)  %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
ntiros <- df %>% group_by(Equipo_contrario) %>% summarise(tiros=n())
liga <- liga %>%
mutate(Squad=chartr("áéíóú", "aeiou", Squad)) %>%
mutate(Squad=case_when(
Squad=='Betis' ~ 'Real Betis',
Squad=='Valladolid' ~ 'Real Valladolid',
TRUE ~ Squad))
ntiros <- ntiros %>% left_join(select(liga, Rk, Squad), by=c("Equipo_contrario"="Squad"))
ntiros %>% ggplot(aes(x=Rk, y=tiros, label=Equipo_contrario)) + geom_point()  +
geom_text_repel(size = 3)
df %>% ggplot(aes(x=xg)) + geom_histogram()
View(df)
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.2) %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.25) %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
View(liga)
laliga <- tiros %>% filter(league_name=='LaLiga')
View(laliga)
table(laliga$situation)
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team)) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name, situation)
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% filter(event_type=='AttemptSaved') %>% group_by(Equipo_contrario)  %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
ntiros <- df %>% group_by(Equipo_contrario) %>% summarise(tiros=n())
liga <- liga %>%
mutate(Squad=chartr("áéíóú", "aeiou", Squad)) %>%
mutate(Squad=case_when(
Squad=='Betis' ~ 'Real Betis',
Squad=='Valladolid' ~ 'Real Valladolid',
TRUE ~ Squad))
ntiros <- ntiros %>% left_join(select(liga, Rk, Squad), by=c("Equipo_contrario"="Squad"))
View(ntiros)
ntiros %>% ggplot(aes(x=Rk, y=tiros, label=Equipo_contrario)) + geom_point()  +
geom_text_repel(size = 3)
df %>% ggplot(aes(x=xg)) + geom_histogram()
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.25 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.40 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.30 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.25 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% ggplot(aes(x=xg)) + geom_histogram()
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
tiros <- readRDS( './data/tiros_202211.rds')
laliga <- tiros %>% filter(league_name=='LaLiga')
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team)) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name, situation)
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team),
En_descenso = case_when(
Equipo %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name, situation)
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team),
En_descenso = case_when(
Equipo %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name, situation)
df %>% group_by(Equipo_contrario, En_descenso) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
View(df)
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team),
En_descenso = case_when(
Equipo %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name, situation, En_descenso)
df %>% group_by(Equipo_contrario, En_descenso) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
View(df)
df %>% group_by(Equipo_contrario, En_descenso) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
View(df)
df %>% group_by(Equipo_contrario, En_descenso) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros))
df <- laliga %>%
mutate(Equipo = case_when(
team_id==home_team_id ~ home_team,
TRUE ~ away_team),
xg = expected_goals,
Equipo_contrario = case_when(
team_id==away_team_id ~ home_team,
TRUE ~ away_team),
En_descenso = case_when(
Equipo %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
select(Equipo,Equipo_contrario, xg, event_type, last_name, situation, En_descenso)
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% filter(event_type=='AttemptSaved') %>% group_by(Equipo_contrario)  %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, fill=En_descenso), show.legend = FALSE) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>% summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light()
df %>% filter(event_type=='AttemptSaved') %>% group_by(Equipo_contrario)  %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros,  fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5,  show.legend = FALSE) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>%
summarise(tiros=n(), salvados=sum(ifelse(event_type=='AttemptSaved',1,0))) %>%
mutate(pct_paradas = round(salvados/tiros,3),
Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=pct_paradas, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>%
summarise(tiros=n(), salvados=sum(ifelse(event_type=='AttemptSaved',1,0))) %>%
mutate(pct_paradas = round(salvados/tiros,3),
Equipo_contrario = fct_reorder(Equipo_contrario, pct_paradas),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=pct_paradas, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>%
summarise(tiros=n(), salvados=sum(ifelse(event_type=='AttemptSaved',1,0))) %>%
mutate(pct_paradas = round(salvados/tiros,3),
Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=pct_paradas, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>%
summarise(tiros=n(), salvados=sum(ifelse(event_type=='AttemptSaved',1,0))) %>%
mutate(pct_paradas = round(salvados/tiros,3),
Equipo_contrario = fct_reorder(Equipo_contrario, salvados),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=pct_paradas, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light()
df %>% group_by(Equipo_contrario) %>%
summarise(tiros=n(), salvados=sum(ifelse(event_type=='AttemptSaved',1,0))) %>%
mutate(pct_paradas = round(salvados/tiros,3),
Equipo_contrario = fct_reorder(Equipo_contrario, pct_paradas),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=pct_paradas, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light()
ntiros <- df %>% group_by(Equipo_contrario) %>% summarise(tiros=n())
liga <- liga %>%
mutate(Squad=chartr("áéíóú", "aeiou", Squad)) %>%
mutate(Squad=case_when(
Squad=='Betis' ~ 'Real Betis',
Squad=='Valladolid' ~ 'Real Valladolid',
TRUE ~ Squad))
ntiros <- ntiros %>% left_join(select(liga, Rk, Squad), by=c("Equipo_contrario"="Squad"))
ntiros %>% ggplot(aes(x=Rk, y=tiros, label=Equipo_contrario)) + geom_point()  +
geom_text_repel(size = 3)
df %>% ggplot(aes(x=xg)) + geom_histogram()
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
mutate(En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
mutate(En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros)) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) + geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, color=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras')
df %>% group_by(Equipo_contrario) %>% filter(xg>=0.20 & situation != 'Penalty') %>%
summarise(tiros=n()) %>%
mutate(Equipo_contrario = fct_reorder(Equipo_contrario, tiros),
En_descenso = case_when(
Equipo_contrario %in% c('Cadiz', 'Elche', 'Sevilla', 'Celta Vigo') ~ 'En descenso',
TRUE ~ 'No descenso')) %>%
ggplot(aes(x=Equipo_contrario, y=tiros, fill=En_descenso)) +
geom_bar(stat = "identity" , alpha=0.5, show.legend = FALSE) +
coord_flip() +  theme_light() + ggtitle('Ocasiones claras (sin penaltis)')
